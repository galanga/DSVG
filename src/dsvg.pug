xsl:stylesheet(xmlns:xsl='http://www.w3.org/1999/XSL/Transform', version='1.0')
  xsl:template(match='@*|node()')
    xsl:copy
      xsl:apply-templates(select='@*|node()')/

  xsl:template(match='path')
    path
      xsl:copy-of(select='@*')/
      xsl:attribute(name='d')
        xsl:value-of(select='@d')/
        xsl:for-each(select='./*')
          xsl:choose
  
            xsl:when(test="name() = 'lineto'")
              xsl:choose
                xsl:when(test="@type='relative' or @type='rel'")
                  xsl:choose
                    xsl:when(test="@y and not(@x)")
                      xsl:value-of(select='"v"')/
                      xsl:value-of(select='@y')/
                    xsl:when(test="@x and not(@y)")
                      xsl:value-of(select='"h"')/
                      xsl:value-of(select='@x')/
                    xsl:when(test="@x and @y")
                      xsl:value-of(select='"l"')/
                      xsl:value-of(select='@x')/
                      xsl:value-of(select='","')/
                      xsl:value-of(select='@y')/
                    xsl:otherwise
                      xsl:value-of(select='"l"')/
                      xsl:value-of(select='@d')/

                // default to absolute positioning if relative not specified
                xsl:otherwise  
                  xsl:choose
                    xsl:when(test="@y and not(@x)")
                      xsl:value-of(select='"V"')/
                      xsl:value-of(select='@y')/
                    xsl:when(test="@x and not(@y)")
                      xsl:value-of(select='"H"')/
                      xsl:value-of(select='@x')/
                    xsl:when(test="@x and @y")
                      xsl:value-of(select='"L"')/
                      xsl:value-of(select='@x')/
                      xsl:value-of(select='","')/
                      xsl:value-of(select='@y')/
                    xsl:otherwise
                      xsl:value-of(select='"L"')/
                      xsl:value-of(select='@d')/

            xsl:when(test="name() = 'moveto'")
              xsl:choose
                xsl:when(test="@type='relative' or @type='rel'")
                  xsl:choose
                    xsl:when(test="@x and @y")
                      xsl:value-of(select='"m"')/
                      xsl:value-of(select='@x')/
                      xsl:value-of(select='","')/
                      xsl:value-of(select='@y')/
                    xsl:otherwise
                      xsl:value-of(select='"m"')/
                      xsl:value-of(select='@d')/

                // default to absolute positioning
                xsl:otherwise
                  xsl:choose
                    xsl:when(test="@x and @y")
                      xsl:value-of(select='"M"')/
                      xsl:value-of(select='@x')/
                      xsl:value-of(select='","')/
                      xsl:value-of(select='@y')/
                    xsl:otherwise
                      xsl:value-of(select='"M"')/
                      xsl:value-of(select='@d')/

            xsl:when(test="name() = 'pathseg'")
              xsl:value-of(select='@d')/

            xsl:when(test="name() = 'closepath'")
              xsl:value-of(select="'z'")/

  
= "\n"
